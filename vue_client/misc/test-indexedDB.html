<html>
<head>
    <script>
        class DB {
            constructor(database, version, type, tableName, keyPath, callback = '') {
                console.log('DB.constructor("' + database + '","' + version + '")')
                this.db = null
                this.database = database
                this.type = type
                this.tableName = tableName
                this.version = version
                this.callback = callback
                this.createDB()
            }

            init() {

            }

            createDB() {
                //open()方法：如果该数据库不存在，则会被创建；如果已经存在，则被打开。
                let request = window.indexedDB.open(this.database, this.version);

                request.onsuccess = function (event) {
                    console.log('数据库创建成功')
                    this.db = request.result;
                    this.onSuccess(this.type)
                };
                request.onupgradeneeded = function (event) {
                    console.log('数据库升级成功')
                    this.db = event.target.result;
                    this.onUpgrade()
                };
            }

            onSuccess(type) {
                switch (type) {
                    case 'get':
                        this.get()
                        break;
                    case 'store':
                        this.store()
                        break;
                    case 'create':
                        this.store()
                        break;
                    case 'remove':
                        this.remove()
                        break;
                    case 'update':
                        this.update()
                        break;
                }
            }
            //数据库（chat_room）-》对象存储空间（users表）-》键值对
            onUpgrade() {
                let objectStore = this.db.createObjectStore('users', {keyPath: "send_time"});
                objectStore.createIndex("id", "id", {unique: true});
            }

            get() {

            }

            create() {
                console.log('create table users')

            }

            store() {

            }

            remove() {

            }
        }


        new DB('chat_room', 1, 'create', 'users', 'id')


    </script>
</head>
<body>

</body>
</html>
